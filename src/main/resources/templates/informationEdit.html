<!DOCTYPE html>
<html xmlns:th="http://tymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>おしらせ投稿フォーム</title>

</head>

<body>
    <div th:insert="~{navbar}"> </div>
    <div id="msg">
        <label>おしらせ投稿</label>
        <input id="csrf" type="hidden" th:name="${_csrf.headerName}" th:value="${_csrf.token}" />
        <textarea id="message" rows="20" cols="40">あいうえお</textarea>
        <button id="send" onclick='postInfo();'>送信</button>
    </div>
    <form class="infoform">
        <table id="infos">
        </table>
    </form>

    <script th:src="@{/js/refresh.js}"></script>
    <script type="text/javascript">
        refreshInfoTbl();
        
        function postInfo() {
            let data = JSON.stringify({
                message: document.getElementById("message").value
            });

            postRequest("/insertinfo", data, function(){
                document.getElementById("message").value = "";
                refreshInfoTbl();
            })
        }

        function refreshInfoTbl() {
            getRequest("/getinfo", function(response){
                var js = JSON.parse(response);
                var tb = document.getElementById("infos");
                tb.innerHTML = "";
                js.forEach(element => {
                    tb.innerHTML += 
                    '<tr><td><textarea>' + element.message + '</textarea></td></tr>';
                });
                var  form = document.getElementsByClassName("infoform");
                form[0].scrollTo(0, form[0].scrollHeight);
            })

        }
    </script>

</body>

</html>